schema: spec-driven

context: |
  Project: Digital Recipe Book Web Application
  Domain: Personal recipe management for couple

  Tech Stack:
  - Framework: Next.js 14 with TypeScript (App Router)
  - Database: Supabase (PostgreSQL + Auth + Storage)
  - Deployment: Vercel
  - OCR: Claude Vision API (photo → structured recipe JSON)
  - URL parsing: schema.org Recipe markup parser
  - Styling: TBD (Tailwind CSS recommended)

  Users:
  - 2 users only: owner and wife (email/password auth)
  - No public registration
  - Future: guest reviewers, Telegram bot

  Recipe Input Methods:
  - Manual entry (structured form with ingredients table)
  - URL import (parse recipe websites via schema.org, strip all non-recipe slop)
  - Instagram import (extract from post caption or recipe card images)
  - Photo OCR (upload cookbook photo → Claude Vision → structured recipe)
  - Future: Telegram message/photo → auto-import

  Recipe Extraction Rules:
  - ONLY extract recipe data - never life stories, SEO filler, ads, engagement bait
  - All sources must produce the same structured format
  - Ingredients must be parsed into: quantity (decimal), unit (standardized), name, notes
  - Use /recipe-extract skill for consistent extraction across all sources
  - Always let user review extracted data before saving

  Database Schema:
  - recipes: title, description, source_url, source_type (manual/url/photo/telegram),
    source_image_path, instructions, prep_time_minutes, cook_time_minutes,
    servings, created_by, created_at, updated_at
  - recipe_ingredients: recipe_id, ingredient_name, quantity (decimal),
    unit, notes, order_index
  - recipe_ratings: recipe_id, user_id, rating (1-5), notes, cooked_date
  - recipe_tags: recipe_id, tag
  - recipe_images: recipe_id, storage_path, is_primary (for source photos)

  Conventions:
  - Mobile-first design (used while cooking in kitchen)
  - Big tap targets, high contrast, readable fonts
  - All recipe inputs converge on same structured format
  - Simple, clean interface - no unnecessary features

  Build Sequence:
  1. setup-project-foundation (Next.js + Supabase + Auth + DB + Vercel)
  2. add-manual-recipe-entry (form + list + detail page)
  3. add-url-import (schema.org parser, strip all website slop)
  4. add-instagram-import (extract from posts/captions/recipe cards)
  5. add-photo-ocr-import (Claude Vision API for cookbook photos)
  6. add-ratings-notes (stars + cooking notes)
  7. add-search-filter (search + tags + sorting)

rules:
  proposal:
    - Consider mobile usability (used in kitchen with messy hands)
    - Keep scope tight - only what's needed for this change
    - Reference the build sequence above for context

  specs:
    - Only 2 users (owner + wife), no public access
    - Consider edge cases for recipe parsing (different site formats)
    - Include realistic test scenarios with actual recipe URLs

  design:
    - Mobile-first responsive design
    - All recipe inputs must produce the same structured format
    - Use Supabase RLS for row-level security
    - Plan for hundreds of recipes, not thousands

  tasks:
    - Break into small, testable vertical slices
    - Each task should be independently verifiable
    - Include testing with real recipe URLs/photos where applicable
